global with Sharing class UpdateProjectRelatedData implements Database.Batchable<sObject>,Database.AllowsCallouts,Database.Stateful{
    public List<JiraErrorLogs__c> JiraLogsToInsert = new List<JiraErrorLogs__c>();
    String query=''; 
    Map<String,String> projectKeyToIdMap=new Map<String,String>();
    
    public UpdateProjectRelatedData(){      
        this.query = 'select id,ProjectId__c , ProjectKey__c From Jira_Project__c LIMIT 1000';   
    }
    
    global Database.QueryLocator start(Database.BatchableContext BC){
        
        return Database.getQueryLocator(query);
    }
    
    global void execute(Database.BatchableContext BC, List<Jira_Project__c> scope){
        
        
        List<Jira_ProjectFieldsMapping__c> LinkedIssuesFieldList = new  List<Jira_ProjectFieldsMapping__c>();
        List<Jira_ProjectFieldsMapping__c> FdList = new List<Jira_ProjectFieldsMapping__c>();
        
        for(Jira_Project__c jp : scope){        
            
            String ProjectKey=jp.ProjectKey__c;
            ID proId=Jp.id;
            
            String FinalJson='';
            Jira_Project__c Project  = new Jira_Project__c(id=proId);
            ProjectsJson Finaljsondata;
            ProjectsJsonWithOutAllowed FinaljsondataNotAllowed;
            
            set<String> Issuetypes=new  set<String>();
            
            HttpRequest req = new HttpRequest();
            Http http = new Http();
            HTTPResponse res;
            try{
                req = new HttpRequest();
                req = CreateJIRAWrapper.CreateRequest('/rest/api/2/issue/createmeta?projectKeys='+ProjectKey ,'GET' ,'application/json');
                String JsonStringData='';
                
                if(!Test.isRunningTest()){
                    res = http.send(req);
                    JsonStringData=res.getBody();
                }else{
                    JsonStringData ='{"expand":"projects","projects":[{"expand":"issuetypes","self":"https://jiragrazitti1.atlassian.net/rest/api/2/project/10001","id":"10000","key":"TP","name":"Test Project","avatarUrls":{"48x48":"https://jiragrazitti1.atlassian.net/secure/projectavatar?pid=10001&avatarId=10400","24x24":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=small&pid=10001&avatarId=10400","16x16":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=xsmall&pid=10001&avatarId=10400","32x32":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=medium&pid=10001&avatarId=10400"},"issuetypes":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10002","id":"10002","description":"A task that needs to be done.","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10318&avatarType=issuetype","name":"Task","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","key":"summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","key":"issuetype","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10002","id":"10002","description":"A task that needs to be done.","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10318&avatarType=issuetype","name":"Task","subtask":false,"avatarId":10318}]},"components":{"required":false,"schema":{"type":"array","items":"component","system":"components"},"name":"Component/s","key":"components","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10001","id":"10001","name":"TEST 2 comp TP"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10000","id":"10000","name":"Test Comp TP"}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","key":"description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","key":"project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/project/10001","id":"10001","key":"TP","name":"Test Project","projectTypeKey":"software","avatarUrls":{"48x48":"https://jiragrazitti1.atlassian.net/secure/projectavatar?pid=10001&avatarId=10400","24x24":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=small&pid=10001&avatarId=10400","16x16":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=xsmall&pid=10001&avatarId=10400","32x32":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=medium&pid=10001&avatarId=10400"}}]},"customfield_10010":{"required":true,"schema":{"type":"array","items":"string","custom":"com.pyxis.greenhopper.jira:gh-sprint","customId":10010},"name":"Sprint","key":"customfield_10010","hasDefaultValue":false,"operations":["set"]},"customfield_10021":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10021},"name":"Example","key":"customfield_10021","hasDefaultValue":false,"operations":["set"]},"fixVersions":{"required":false,"schema":{"type":"array","items":"version","system":"fixVersions"},"name":"Fix Version/s","key":"fixVersions","hasDefaultValue":false,"operations":["set","add","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10000","id":"10000","name":"TP-version 1.0","archived":false,"released":true,"releaseDate":"2018-01-21","userReleaseDate":"21/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10001","id":"10001","name":"TP-version 2.0","archived":false,"released":true,"releaseDate":"2018-01-22","userReleaseDate":"22/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10002","id":"10002","name":"Version 1 Tp","archived":false,"released":false,"projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10003","id":"10003","name":"version 2 tp","archived":false,"released":false,"projectId":10001}]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","key":"priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/1","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/highest.svg","name":"Highest","id":"1"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/2","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/high.svg","name":"High","id":"2"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/4","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/low.svg","name":"Low","id":"4"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/5","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/lowest.svg","name":"Lowest","id":"5"}],"defaultValue":{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"}},"labels":{"required":true,"schema":{"type":"array","items":"string","system":"labels"},"name":"Labels","key":"labels","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10028":{"required":false,"schema":{"type":"array","items":"option","custom":"com.atlassian.jira.plugin.system.customfieldtypes:multiselect","customId":10028},"name":"multi select","key":"customfield_10028","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10006","value":"qwerty","id":"10006"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10007","value":"asdfghj","id":"10007"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10008","value":"zxcvbnm","id":"10008"}]},"customfield_10018":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10018},"name":"Precondition","key":"customfield_10018","hasDefaultValue":false,"operations":["set"]},"customfield_10029":{"required":false,"schema":{"type":"array","items":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:labels","customId":10029},"name":"CaseNumber","key":"customfield_10029","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?customFieldId=10029&query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10008":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10008},"name":"Epic Link","key":"customfield_10008","hasDefaultValue":false,"operations":["set"]},"customfield_10019":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10019},"name":"Biz Impact","key":"customfield_10019","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","key":"attachment","hasDefaultValue":false,"operations":[]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","key":"issuelinks","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","key":"assignee","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/latest/user/assignable/search?project=TP&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10003","id":"10003","description":"The sub-task of the issue","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10316&avatarType=issuetype","name":"Sub-task","subtask":true,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","key":"summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","key":"issuetype","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10003","id":"10003","description":"The sub-task of the issue","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10316&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":10316}]},"parent":{"required":true,"schema":{"type":"issuelink","system":"parent"},"name":"Parent","key":"parent","hasDefaultValue":false,"operations":["set"]},"components":{"required":false,"schema":{"type":"array","items":"component","system":"components"},"name":"Component/s","key":"components","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10001","id":"10001","name":"TEST 2 comp TP"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10000","id":"10000","name":"Test Comp TP"}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","key":"description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","key":"project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/project/10001","id":"10001","key":"TP","name":"Test Project","projectTypeKey":"software","avatarUrls":{"48x48":"https://jiragrazitti1.atlassian.net/secure/projectavatar?pid=10001&avatarId=10400","24x24":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=small&pid=10001&avatarId=10400","16x16":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=xsmall&pid=10001&avatarId=10400","32x32":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=medium&pid=10001&avatarId=10400"}}]},"customfield_10010":{"required":true,"schema":{"type":"array","items":"string","custom":"com.pyxis.greenhopper.jira:gh-sprint","customId":10010},"name":"Sprint","key":"customfield_10010","hasDefaultValue":false,"operations":["set"]},"customfield_10021":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10021},"name":"Example","key":"customfield_10021","hasDefaultValue":false,"operations":["set"]},"fixVersions":{"required":false,"schema":{"type":"array","items":"version","system":"fixVersions"},"name":"Fix Version/s","key":"fixVersions","hasDefaultValue":false,"operations":["set","add","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10000","id":"10000","name":"TP-version 1.0","archived":false,"released":true,"releaseDate":"2018-01-21","userReleaseDate":"21/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10001","id":"10001","name":"TP-version 2.0","archived":false,"released":true,"releaseDate":"2018-01-22","userReleaseDate":"22/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10002","id":"10002","name":"Version 1 Tp","archived":false,"released":false,"projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10003","id":"10003","name":"version 2 tp","archived":false,"released":false,"projectId":10001}]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","key":"priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/1","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/highest.svg","name":"Highest","id":"1"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/2","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/high.svg","name":"High","id":"2"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/4","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/low.svg","name":"Low","id":"4"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/5","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/lowest.svg","name":"Lowest","id":"5"}],"defaultValue":{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"}},"labels":{"required":true,"schema":{"type":"array","items":"string","system":"labels"},"name":"Labels","key":"labels","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10028":{"required":false,"schema":{"type":"array","items":"option","custom":"com.atlassian.jira.plugin.system.customfieldtypes:multiselect","customId":10028},"name":"multi select","key":"customfield_10028","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10006","value":"qwerty","id":"10006"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10007","value":"asdfghj","id":"10007"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10008","value":"zxcvbnm","id":"10008"}]},"customfield_10018":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10018},"name":"Precondition","key":"customfield_10018","hasDefaultValue":false,"operations":["set"]},"customfield_10029":{"required":false,"schema":{"type":"array","items":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:labels","customId":10029},"name":"CaseNumber","key":"customfield_10029","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?customFieldId=10029&query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10008":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10008},"name":"Epic Link","key":"customfield_10008","hasDefaultValue":false,"operations":["set"]},"customfield_10019":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10019},"name":"Biz Impact","key":"customfield_10019","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","key":"attachment","hasDefaultValue":false,"operations":[]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","key":"issuelinks","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","key":"assignee","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/latest/user/assignable/search?project=TP&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10001","id":"10001","description":"A user story. Created by Jira Software - do not edit or delete.","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10315&avatarType=issuetype","name":"Story","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","key":"summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","key":"issuetype","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10001","id":"10001","description":"A user story. Created by Jira Software - do not edit or delete.","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10315&avatarType=issuetype","name":"Story","subtask":false,"avatarId":10315}]},"components":{"required":false,"schema":{"type":"array","items":"component","system":"components"},"name":"Component/s","key":"components","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10001","id":"10001","name":"TEST 2 comp TP"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10000","id":"10000","name":"Test Comp TP"}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","key":"description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","key":"project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/project/10001","id":"10001","key":"TP","name":"Test Project","projectTypeKey":"software","avatarUrls":{"48x48":"https://jiragrazitti1.atlassian.net/secure/projectavatar?pid=10001&avatarId=10400","24x24":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=small&pid=10001&avatarId=10400","16x16":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=xsmall&pid=10001&avatarId=10400","32x32":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=medium&pid=10001&avatarId=10400"}}]},"customfield_10010":{"required":false,"schema":{"type":"array","items":"string","custom":"com.pyxis.greenhopper.jira:gh-sprint","customId":10010},"name":"Sprint","key":"customfield_10010","hasDefaultValue":false,"operations":["set"]},"customfield_10021":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10021},"name":"Example","key":"customfield_10021","hasDefaultValue":false,"operations":["set"]},"fixVersions":{"required":false,"schema":{"type":"array","items":"version","system":"fixVersions"},"name":"Fix Version/s","key":"fixVersions","hasDefaultValue":false,"operations":["set","add","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10000","id":"10000","name":"TP-version 1.0","archived":false,"released":true,"releaseDate":"2018-01-21","userReleaseDate":"21/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10001","id":"10001","name":"TP-version 2.0","archived":false,"released":true,"releaseDate":"2018-01-22","userReleaseDate":"22/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10002","id":"10002","name":"Version 1 Tp","archived":false,"released":false,"projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10003","id":"10003","name":"version 2 tp","archived":false,"released":false,"projectId":10001}]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","key":"priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/1","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/highest.svg","name":"Highest","id":"1"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/2","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/high.svg","name":"High","id":"2"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/4","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/low.svg","name":"Low","id":"4"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/5","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/lowest.svg","name":"Lowest","id":"5"}],"defaultValue":{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"}},"labels":{"required":true,"schema":{"type":"array","items":"string","system":"labels"},"name":"Labels","key":"labels","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10028":{"required":false,"schema":{"type":"array","items":"option","custom":"com.atlassian.jira.plugin.system.customfieldtypes:multiselect","customId":10028},"name":"multi select","key":"customfield_10028","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10006","value":"qwerty","id":"10006"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10007","value":"asdfghj","id":"10007"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10008","value":"zxcvbnm","id":"10008"}]},"customfield_10018":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10018},"name":"Precondition","key":"customfield_10018","hasDefaultValue":false,"operations":["set"]},"customfield_10029":{"required":false,"schema":{"type":"array","items":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:labels","customId":10029},"name":"CaseNumber","key":"customfield_10029","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?customFieldId=10029&query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10008":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10008},"name":"Epic Link","key":"customfield_10008","hasDefaultValue":false,"operations":["set"]},"customfield_10019":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10019},"name":"Biz Impact","key":"customfield_10019","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","key":"attachment","hasDefaultValue":false,"operations":[]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","key":"issuelinks","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","key":"assignee","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/latest/user/assignable/search?project=TP&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10004","id":"10004","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10303&avatarType=issuetype","name":"Bug","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","key":"summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","key":"issuetype","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10004","id":"10004","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10303&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":10303}]},"components":{"required":false,"schema":{"type":"array","items":"component","system":"components"},"name":"Component/s","key":"components","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10001","id":"10001","name":"TEST 2 comp TP"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10000","id":"10000","name":"Test Comp TP"}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","key":"description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","key":"project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/project/10001","id":"10001","key":"TP","name":"Test Project","projectTypeKey":"software","avatarUrls":{"48x48":"https://jiragrazitti1.atlassian.net/secure/projectavatar?pid=10001&avatarId=10400","24x24":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=small&pid=10001&avatarId=10400","16x16":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=xsmall&pid=10001&avatarId=10400","32x32":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=medium&pid=10001&avatarId=10400"}}]},"customfield_10010":{"required":false,"schema":{"type":"array","items":"string","custom":"com.pyxis.greenhopper.jira:gh-sprint","customId":10010},"name":"Sprint","key":"customfield_10010","hasDefaultValue":false,"operations":["set"]},"customfield_10021":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10021},"name":"Example","key":"customfield_10021","hasDefaultValue":false,"operations":["set"]},"fixVersions":{"required":false,"schema":{"type":"array","items":"version","system":"fixVersions"},"name":"Fix Version/s","key":"fixVersions","hasDefaultValue":false,"operations":["set","add","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10000","id":"10000","name":"TP-version 1.0","archived":false,"released":true,"releaseDate":"2018-01-21","userReleaseDate":"21/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10001","id":"10001","name":"TP-version 2.0","archived":false,"released":true,"releaseDate":"2018-01-22","userReleaseDate":"22/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10002","id":"10002","name":"Version 1 Tp","archived":false,"released":false,"projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10003","id":"10003","name":"version 2 tp","archived":false,"released":false,"projectId":10001}]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","key":"priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/1","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/highest.svg","name":"Highest","id":"1"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/2","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/high.svg","name":"High","id":"2"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/4","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/low.svg","name":"Low","id":"4"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/5","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/lowest.svg","name":"Lowest","id":"5"}],"defaultValue":{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"}},"labels":{"required":true,"schema":{"type":"array","items":"string","system":"labels"},"name":"Labels","key":"labels","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10028":{"required":false,"schema":{"type":"array","items":"option","custom":"com.atlassian.jira.plugin.system.customfieldtypes:multiselect","customId":10028},"name":"multi select","key":"customfield_10028","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10006","value":"qwerty","id":"10006"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10007","value":"asdfghj","id":"10007"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10008","value":"zxcvbnm","id":"10008"}]},"environment":{"required":false,"schema":{"type":"string","system":"environment"},"name":"Environment","key":"environment","hasDefaultValue":false,"operations":["set"]},"customfield_10018":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10018},"name":"Precondition","key":"customfield_10018","hasDefaultValue":false,"operations":["set"]},"customfield_10029":{"required":false,"schema":{"type":"array","items":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:labels","customId":10029},"name":"CaseNumber","key":"customfield_10029","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?customFieldId=10029&query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10008":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10008},"name":"Epic Link","key":"customfield_10008","hasDefaultValue":false,"operations":["set"]},"customfield_10019":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10019},"name":"Biz Impact","key":"customfield_10019","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","key":"attachment","hasDefaultValue":false,"operations":[]},"versions":{"required":false,"schema":{"type":"array","items":"version","system":"versions"},"name":"Affects Version/s","key":"versions","hasDefaultValue":false,"operations":["set","add","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10000","id":"10000","name":"TP-version 1.0","archived":false,"released":true,"releaseDate":"2018-01-21","userReleaseDate":"21/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10001","id":"10001","name":"TP-version 2.0","archived":false,"released":true,"releaseDate":"2018-01-22","userReleaseDate":"22/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10002","id":"10002","name":"Version 1 Tp","archived":false,"released":false,"projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10003","id":"10003","name":"version 2 tp","archived":false,"released":false,"projectId":10001}]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","key":"issuelinks","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","key":"assignee","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/latest/user/assignable/search?project=TP&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10000","id":"10000","description":"A big user story that needs to be broken down. Created by Jira Software - do not edit or delete.","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/issuetypes/epic.svg","name":"Epic","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","key":"summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","key":"issuetype","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10000","id":"10000","description":"A big user story that needs to be broken down. Created by Jira Software - do not edit or delete.","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/issuetypes/epic.svg","name":"Epic","subtask":false}]},"components":{"required":false,"schema":{"type":"array","items":"component","system":"components"},"name":"Component/s","key":"components","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10001","id":"10001","name":"TEST 2 comp TP"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10000","id":"10000","name":"Test Comp TP"}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","key":"description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","key":"project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/project/10001","id":"10001","key":"TP","name":"Test Project","projectTypeKey":"software","avatarUrls":{"48x48":"https://jiragrazitti1.atlassian.net/secure/projectavatar?pid=10001&avatarId=10400","24x24":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=small&pid=10001&avatarId=10400","16x16":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=xsmall&pid=10001&avatarId=10400","32x32":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=medium&pid=10001&avatarId=10400"}}]},"customfield_10010":{"required":false,"schema":{"type":"array","items":"string","custom":"com.pyxis.greenhopper.jira:gh-sprint","customId":10010},"name":"Sprint","key":"customfield_10010","hasDefaultValue":false,"operations":["set"]},"customfield_10021":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10021},"name":"Example","key":"customfield_10021","hasDefaultValue":false,"operations":["set"]},"fixVersions":{"required":false,"schema":{"type":"array","items":"version","system":"fixVersions"},"name":"Fix Version/s","key":"fixVersions","hasDefaultValue":false,"operations":["set","add","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10000","id":"10000","name":"TP-version 1.0","archived":false,"released":true,"releaseDate":"2018-01-21","userReleaseDate":"21/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10001","id":"10001","name":"TP-version 2.0","archived":false,"released":true,"releaseDate":"2018-01-22","userReleaseDate":"22/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10002","id":"10002","name":"Version 1 Tp","archived":false,"released":false,"projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10003","id":"10003","name":"version 2 tp","archived":false,"released":false,"projectId":10001}]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","key":"priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/1","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/highest.svg","name":"Highest","id":"1"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/2","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/high.svg","name":"High","id":"2"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/4","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/low.svg","name":"Low","id":"4"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/5","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/lowest.svg","name":"Lowest","id":"5"}],"defaultValue":{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"}},"labels":{"required":true,"schema":{"type":"array","items":"string","system":"labels"},"name":"Labels","key":"labels","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10005":{"required":false,"schema":{"type":"string","custom":"com.pyxis.greenhopper.jira:gh-epic-label","customId":10005},"name":"Epic Name","key":"customfield_10005","hasDefaultValue":false,"operations":["set"]},"customfield_10028":{"required":false,"schema":{"type":"array","items":"option","custom":"com.atlassian.jira.plugin.system.customfieldtypes:multiselect","customId":10028},"name":"multi select","key":"customfield_10028","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10006","value":"qwerty","id":"10006"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10007","value":"asdfghj","id":"10007"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10008","value":"zxcvbnm","id":"10008"}]},"customfield_10018":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10018},"name":"Precondition","key":"customfield_10018","hasDefaultValue":false,"operations":["set"]},"customfield_10029":{"required":false,"schema":{"type":"array","items":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:labels","customId":10029},"name":"CaseNumber","key":"customfield_10029","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?customFieldId=10029&query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10008":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10008},"name":"Epic Link","key":"customfield_10008","hasDefaultValue":false,"operations":["set"]},"customfield_10019":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10019},"name":"Biz Impact","key":"customfield_10019","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","key":"attachment","hasDefaultValue":false,"operations":[]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","key":"issuelinks","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","key":"assignee","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/latest/user/assignable/search?project=TP&username=","hasDefaultValue":false,"operations":["set"]}}}]}]}';
                        
                        }
                
                if((res!=null && res.getStatusCode()==200) ||Test.isRunningTest()){
                    Map<String, Object> Main = (Map<String, Object>) JSON.deserializeUntyped(JsonStringData);
                    
                    Object JsonObj=Main.get('projects');
                    String JsonString = JSON.serialize(JsonObj);
                    ProjectsJson jsondata;
                    JSONParser parser = JSON.createParser(JsonString);
                    while (parser.nextToken() != null) {
                        if(parser.getCurrentToken()==JSONToken.START_OBJECT ){ 
                            jsondata=(ProjectsJson)parser.readValueAs(ProjectsJson.class);
                        }
                    }
                    for(ProjectsJson.IssueType IssueType:jsondata.issuetypes){
                        Issuetypes.add(IssueType.id);
                    }
                    
                }else{
                    JiraLogsToInsert.add(GenerateJiraLogs.CreateJiraLog('UpdateProjectRelatedData',req.getEndpoint(), req.getMethod(), String.valueof(res.getstatusCode()),res.getbody(),res.getstatus(), req.getbody() , null, ProjectKey , 'Project Data', res.getbody()));
                    
                }   
            }catch(Exception ex){
                String Error=System.label.cause_Label +ex.getCause()+'\n'+ System.label.LineNumber_Label +ex.getLineNumber()+'\n'+ System.label.Message_Label +ex.getMessage();
                JiraLogsToInsert.add(GenerateJiraLogs.CreateJiraLog('UpdateProjectRelatedData',req.getEndpoint(), req.getMethod(), String.valueof(res.getstatusCode()),res.getbody(),res.getstatus(), req.getbody() , null, ProjectKey , 'Project Data', Error));
            }
            integer i=0;
            
            for(String Issue:Issuetypes){
                String jiraMetadataJson= null;
                req = new HttpRequest();
                http = new Http();
                String JsonStringData;
                try{
                    req = new HttpRequest();
                    req = CreateJIRAWrapper.CreateRequest('/rest/api/2/issue/createmeta?projectKeys='+ProjectKey+'&issuetypeIds='+Issue+'&expand=projects.issuetypes.fields' ,'GET' ,'application/json');
                    if(!Test.isRunningTest()){
                        res = http.send(req);
                        JsonStringData=res.getBody();
                    }else{
                        JsonStringData ='{"expand":"projects","projects":[{"expand":"issuetypes","self":"https://jiragrazitti1.atlassian.net/rest/api/2/project/10001","id":"10000","key":"TP","name":"Test Project","avatarUrls":{"48x48":"https://jiragrazitti1.atlassian.net/secure/projectavatar?pid=10001&avatarId=10400","24x24":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=small&pid=10001&avatarId=10400","16x16":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=xsmall&pid=10001&avatarId=10400","32x32":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=medium&pid=10001&avatarId=10400"},"issuetypes":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10002","id":"10002","description":"A task that needs to be done.","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10318&avatarType=issuetype","name":"Task","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","key":"summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","key":"issuetype","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10002","id":"10002","description":"A task that needs to be done.","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10318&avatarType=issuetype","name":"Task","subtask":false,"avatarId":10318}]},"components":{"required":false,"schema":{"type":"array","items":"component","system":"components"},"name":"Component/s","key":"components","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10001","id":"10001","name":"TEST 2 comp TP"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10000","id":"10000","name":"Test Comp TP"}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","key":"description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","key":"project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/project/10001","id":"10001","key":"TP","name":"Test Project","projectTypeKey":"software","avatarUrls":{"48x48":"https://jiragrazitti1.atlassian.net/secure/projectavatar?pid=10001&avatarId=10400","24x24":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=small&pid=10001&avatarId=10400","16x16":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=xsmall&pid=10001&avatarId=10400","32x32":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=medium&pid=10001&avatarId=10400"}}]},"customfield_10010":{"required":true,"schema":{"type":"array","items":"string","custom":"com.pyxis.greenhopper.jira:gh-sprint","customId":10010},"name":"Sprint","key":"customfield_10010","hasDefaultValue":false,"operations":["set"]},"customfield_10021":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10021},"name":"Example","key":"customfield_10021","hasDefaultValue":false,"operations":["set"]},"fixVersions":{"required":false,"schema":{"type":"array","items":"version","system":"fixVersions"},"name":"Fix Version/s","key":"fixVersions","hasDefaultValue":false,"operations":["set","add","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10000","id":"10000","name":"TP-version 1.0","archived":false,"released":true,"releaseDate":"2018-01-21","userReleaseDate":"21/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10001","id":"10001","name":"TP-version 2.0","archived":false,"released":true,"releaseDate":"2018-01-22","userReleaseDate":"22/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10002","id":"10002","name":"Version 1 Tp","archived":false,"released":false,"projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10003","id":"10003","name":"version 2 tp","archived":false,"released":false,"projectId":10001}]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","key":"priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/1","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/highest.svg","name":"Highest","id":"1"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/2","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/high.svg","name":"High","id":"2"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/4","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/low.svg","name":"Low","id":"4"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/5","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/lowest.svg","name":"Lowest","id":"5"}],"defaultValue":{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"}},"labels":{"required":true,"schema":{"type":"array","items":"string","system":"labels"},"name":"Labels","key":"labels","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10028":{"required":false,"schema":{"type":"array","items":"option","custom":"com.atlassian.jira.plugin.system.customfieldtypes:multiselect","customId":10028},"name":"multi select","key":"customfield_10028","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10006","value":"qwerty","id":"10006"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10007","value":"asdfghj","id":"10007"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10008","value":"zxcvbnm","id":"10008"}]},"customfield_10018":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10018},"name":"Precondition","key":"customfield_10018","hasDefaultValue":false,"operations":["set"]},"customfield_10029":{"required":false,"schema":{"type":"array","items":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:labels","customId":10029},"name":"CaseNumber","key":"customfield_10029","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?customFieldId=10029&query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10008":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10008},"name":"Epic Link","key":"customfield_10008","hasDefaultValue":false,"operations":["set"]},"customfield_10019":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10019},"name":"Biz Impact","key":"customfield_10019","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","key":"attachment","hasDefaultValue":false,"operations":[]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","key":"issuelinks","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","key":"assignee","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/latest/user/assignable/search?project=TP&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10003","id":"10003","description":"The sub-task of the issue","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10316&avatarType=issuetype","name":"Sub-task","subtask":true,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","key":"summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","key":"issuetype","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10003","id":"10003","description":"The sub-task of the issue","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10316&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":10316}]},"parent":{"required":true,"schema":{"type":"issuelink","system":"parent"},"name":"Parent","key":"parent","hasDefaultValue":false,"operations":["set"]},"components":{"required":false,"schema":{"type":"array","items":"component","system":"components"},"name":"Component/s","key":"components","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10001","id":"10001","name":"TEST 2 comp TP"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10000","id":"10000","name":"Test Comp TP"}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","key":"description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","key":"project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/project/10001","id":"10001","key":"TP","name":"Test Project","projectTypeKey":"software","avatarUrls":{"48x48":"https://jiragrazitti1.atlassian.net/secure/projectavatar?pid=10001&avatarId=10400","24x24":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=small&pid=10001&avatarId=10400","16x16":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=xsmall&pid=10001&avatarId=10400","32x32":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=medium&pid=10001&avatarId=10400"}}]},"customfield_10010":{"required":true,"schema":{"type":"array","items":"string","custom":"com.pyxis.greenhopper.jira:gh-sprint","customId":10010},"name":"Sprint","key":"customfield_10010","hasDefaultValue":false,"operations":["set"]},"customfield_10021":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10021},"name":"Example","key":"customfield_10021","hasDefaultValue":false,"operations":["set"]},"fixVersions":{"required":false,"schema":{"type":"array","items":"version","system":"fixVersions"},"name":"Fix Version/s","key":"fixVersions","hasDefaultValue":false,"operations":["set","add","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10000","id":"10000","name":"TP-version 1.0","archived":false,"released":true,"releaseDate":"2018-01-21","userReleaseDate":"21/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10001","id":"10001","name":"TP-version 2.0","archived":false,"released":true,"releaseDate":"2018-01-22","userReleaseDate":"22/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10002","id":"10002","name":"Version 1 Tp","archived":false,"released":false,"projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10003","id":"10003","name":"version 2 tp","archived":false,"released":false,"projectId":10001}]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","key":"priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/1","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/highest.svg","name":"Highest","id":"1"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/2","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/high.svg","name":"High","id":"2"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/4","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/low.svg","name":"Low","id":"4"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/5","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/lowest.svg","name":"Lowest","id":"5"}],"defaultValue":{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"}},"labels":{"required":true,"schema":{"type":"array","items":"string","system":"labels"},"name":"Labels","key":"labels","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10028":{"required":false,"schema":{"type":"array","items":"option","custom":"com.atlassian.jira.plugin.system.customfieldtypes:multiselect","customId":10028},"name":"multi select","key":"customfield_10028","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10006","value":"qwerty","id":"10006"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10007","value":"asdfghj","id":"10007"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10008","value":"zxcvbnm","id":"10008"}]},"customfield_10018":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10018},"name":"Precondition","key":"customfield_10018","hasDefaultValue":false,"operations":["set"]},"customfield_10029":{"required":false,"schema":{"type":"array","items":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:labels","customId":10029},"name":"CaseNumber","key":"customfield_10029","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?customFieldId=10029&query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10008":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10008},"name":"Epic Link","key":"customfield_10008","hasDefaultValue":false,"operations":["set"]},"customfield_10019":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10019},"name":"Biz Impact","key":"customfield_10019","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","key":"attachment","hasDefaultValue":false,"operations":[]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","key":"issuelinks","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","key":"assignee","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/latest/user/assignable/search?project=TP&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10001","id":"10001","description":"A user story. Created by Jira Software - do not edit or delete.","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10315&avatarType=issuetype","name":"Story","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","key":"summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","key":"issuetype","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10001","id":"10001","description":"A user story. Created by Jira Software - do not edit or delete.","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10315&avatarType=issuetype","name":"Story","subtask":false,"avatarId":10315}]},"components":{"required":false,"schema":{"type":"array","items":"component","system":"components"},"name":"Component/s","key":"components","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10001","id":"10001","name":"TEST 2 comp TP"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10000","id":"10000","name":"Test Comp TP"}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","key":"description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","key":"project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/project/10001","id":"10001","key":"TP","name":"Test Project","projectTypeKey":"software","avatarUrls":{"48x48":"https://jiragrazitti1.atlassian.net/secure/projectavatar?pid=10001&avatarId=10400","24x24":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=small&pid=10001&avatarId=10400","16x16":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=xsmall&pid=10001&avatarId=10400","32x32":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=medium&pid=10001&avatarId=10400"}}]},"customfield_10010":{"required":false,"schema":{"type":"array","items":"string","custom":"com.pyxis.greenhopper.jira:gh-sprint","customId":10010},"name":"Sprint","key":"customfield_10010","hasDefaultValue":false,"operations":["set"]},"customfield_10021":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10021},"name":"Example","key":"customfield_10021","hasDefaultValue":false,"operations":["set"]},"fixVersions":{"required":false,"schema":{"type":"array","items":"version","system":"fixVersions"},"name":"Fix Version/s","key":"fixVersions","hasDefaultValue":false,"operations":["set","add","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10000","id":"10000","name":"TP-version 1.0","archived":false,"released":true,"releaseDate":"2018-01-21","userReleaseDate":"21/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10001","id":"10001","name":"TP-version 2.0","archived":false,"released":true,"releaseDate":"2018-01-22","userReleaseDate":"22/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10002","id":"10002","name":"Version 1 Tp","archived":false,"released":false,"projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10003","id":"10003","name":"version 2 tp","archived":false,"released":false,"projectId":10001}]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","key":"priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/1","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/highest.svg","name":"Highest","id":"1"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/2","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/high.svg","name":"High","id":"2"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/4","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/low.svg","name":"Low","id":"4"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/5","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/lowest.svg","name":"Lowest","id":"5"}],"defaultValue":{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"}},"labels":{"required":true,"schema":{"type":"array","items":"string","system":"labels"},"name":"Labels","key":"labels","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10028":{"required":false,"schema":{"type":"array","items":"option","custom":"com.atlassian.jira.plugin.system.customfieldtypes:multiselect","customId":10028},"name":"multi select","key":"customfield_10028","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10006","value":"qwerty","id":"10006"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10007","value":"asdfghj","id":"10007"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10008","value":"zxcvbnm","id":"10008"}]},"customfield_10018":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10018},"name":"Precondition","key":"customfield_10018","hasDefaultValue":false,"operations":["set"]},"customfield_10029":{"required":false,"schema":{"type":"array","items":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:labels","customId":10029},"name":"CaseNumber","key":"customfield_10029","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?customFieldId=10029&query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10008":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10008},"name":"Epic Link","key":"customfield_10008","hasDefaultValue":false,"operations":["set"]},"customfield_10019":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10019},"name":"Biz Impact","key":"customfield_10019","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","key":"attachment","hasDefaultValue":false,"operations":[]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","key":"issuelinks","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","key":"assignee","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/latest/user/assignable/search?project=TP&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10004","id":"10004","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10303&avatarType=issuetype","name":"Bug","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","key":"summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","key":"issuetype","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10004","id":"10004","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://jiragrazitti1.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10303&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":10303}]},"components":{"required":false,"schema":{"type":"array","items":"component","system":"components"},"name":"Component/s","key":"components","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10001","id":"10001","name":"TEST 2 comp TP"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10000","id":"10000","name":"Test Comp TP"}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","key":"description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","key":"project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/project/10001","id":"10001","key":"TP","name":"Test Project","projectTypeKey":"software","avatarUrls":{"48x48":"https://jiragrazitti1.atlassian.net/secure/projectavatar?pid=10001&avatarId=10400","24x24":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=small&pid=10001&avatarId=10400","16x16":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=xsmall&pid=10001&avatarId=10400","32x32":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=medium&pid=10001&avatarId=10400"}}]},"customfield_10010":{"required":false,"schema":{"type":"array","items":"string","custom":"com.pyxis.greenhopper.jira:gh-sprint","customId":10010},"name":"Sprint","key":"customfield_10010","hasDefaultValue":false,"operations":["set"]},"customfield_10021":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10021},"name":"Example","key":"customfield_10021","hasDefaultValue":false,"operations":["set"]},"fixVersions":{"required":false,"schema":{"type":"array","items":"version","system":"fixVersions"},"name":"Fix Version/s","key":"fixVersions","hasDefaultValue":false,"operations":["set","add","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10000","id":"10000","name":"TP-version 1.0","archived":false,"released":true,"releaseDate":"2018-01-21","userReleaseDate":"21/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10001","id":"10001","name":"TP-version 2.0","archived":false,"released":true,"releaseDate":"2018-01-22","userReleaseDate":"22/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10002","id":"10002","name":"Version 1 Tp","archived":false,"released":false,"projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10003","id":"10003","name":"version 2 tp","archived":false,"released":false,"projectId":10001}]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","key":"priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/1","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/highest.svg","name":"Highest","id":"1"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/2","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/high.svg","name":"High","id":"2"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/4","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/low.svg","name":"Low","id":"4"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/5","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/lowest.svg","name":"Lowest","id":"5"}],"defaultValue":{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"}},"labels":{"required":true,"schema":{"type":"array","items":"string","system":"labels"},"name":"Labels","key":"labels","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10028":{"required":false,"schema":{"type":"array","items":"option","custom":"com.atlassian.jira.plugin.system.customfieldtypes:multiselect","customId":10028},"name":"multi select","key":"customfield_10028","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10006","value":"qwerty","id":"10006"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10007","value":"asdfghj","id":"10007"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10008","value":"zxcvbnm","id":"10008"}]},"environment":{"required":false,"schema":{"type":"string","system":"environment"},"name":"Environment","key":"environment","hasDefaultValue":false,"operations":["set"]},"customfield_10018":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10018},"name":"Precondition","key":"customfield_10018","hasDefaultValue":false,"operations":["set"]},"customfield_10029":{"required":false,"schema":{"type":"array","items":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:labels","customId":10029},"name":"CaseNumber","key":"customfield_10029","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?customFieldId=10029&query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10008":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10008},"name":"Epic Link","key":"customfield_10008","hasDefaultValue":false,"operations":["set"]},"customfield_10019":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10019},"name":"Biz Impact","key":"customfield_10019","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","key":"attachment","hasDefaultValue":false,"operations":[]},"versions":{"required":false,"schema":{"type":"array","items":"version","system":"versions"},"name":"Affects Version/s","key":"versions","hasDefaultValue":false,"operations":["set","add","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10000","id":"10000","name":"TP-version 1.0","archived":false,"released":true,"releaseDate":"2018-01-21","userReleaseDate":"21/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10001","id":"10001","name":"TP-version 2.0","archived":false,"released":true,"releaseDate":"2018-01-22","userReleaseDate":"22/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10002","id":"10002","name":"Version 1 Tp","archived":false,"released":false,"projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10003","id":"10003","name":"version 2 tp","archived":false,"released":false,"projectId":10001}]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","key":"issuelinks","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","key":"assignee","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/latest/user/assignable/search?project=TP&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10000","id":"10000","description":"A big user story that needs to be broken down. Created by Jira Software - do not edit or delete.","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/issuetypes/epic.svg","name":"Epic","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","key":"summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","key":"issuetype","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/issuetype/10000","id":"10000","description":"A big user story that needs to be broken down. Created by Jira Software - do not edit or delete.","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/issuetypes/epic.svg","name":"Epic","subtask":false}]},"components":{"required":false,"schema":{"type":"array","items":"component","system":"components"},"name":"Component/s","key":"components","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10001","id":"10001","name":"TEST 2 comp TP"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/component/10000","id":"10000","name":"Test Comp TP"}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","key":"description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","key":"project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/project/10001","id":"10001","key":"TP","name":"Test Project","projectTypeKey":"software","avatarUrls":{"48x48":"https://jiragrazitti1.atlassian.net/secure/projectavatar?pid=10001&avatarId=10400","24x24":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=small&pid=10001&avatarId=10400","16x16":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=xsmall&pid=10001&avatarId=10400","32x32":"https://jiragrazitti1.atlassian.net/secure/projectavatar?size=medium&pid=10001&avatarId=10400"}}]},"customfield_10010":{"required":false,"schema":{"type":"array","items":"string","custom":"com.pyxis.greenhopper.jira:gh-sprint","customId":10010},"name":"Sprint","key":"customfield_10010","hasDefaultValue":false,"operations":["set"]},"customfield_10021":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10021},"name":"Example","key":"customfield_10021","hasDefaultValue":false,"operations":["set"]},"fixVersions":{"required":false,"schema":{"type":"array","items":"version","system":"fixVersions"},"name":"Fix Version/s","key":"fixVersions","hasDefaultValue":false,"operations":["set","add","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10000","id":"10000","name":"TP-version 1.0","archived":false,"released":true,"releaseDate":"2018-01-21","userReleaseDate":"21/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10001","id":"10001","name":"TP-version 2.0","archived":false,"released":true,"releaseDate":"2018-01-22","userReleaseDate":"22/Jan/18","projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10002","id":"10002","name":"Version 1 Tp","archived":false,"released":false,"projectId":10001},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/version/10003","id":"10003","name":"version 2 tp","archived":false,"released":false,"projectId":10001}]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","key":"priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/1","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/highest.svg","name":"Highest","id":"1"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/2","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/high.svg","name":"High","id":"2"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/4","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/low.svg","name":"Low","id":"4"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/5","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/lowest.svg","name":"Lowest","id":"5"}],"defaultValue":{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/priority/3","iconUrl":"https://jiragrazitti1.atlassian.net/images/icons/priorities/medium.svg","name":"Medium","id":"3"}},"labels":{"required":true,"schema":{"type":"array","items":"string","system":"labels"},"name":"Labels","key":"labels","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10005":{"required":false,"schema":{"type":"string","custom":"com.pyxis.greenhopper.jira:gh-epic-label","customId":10005},"name":"Epic Name","key":"customfield_10005","hasDefaultValue":false,"operations":["set"]},"customfield_10028":{"required":false,"schema":{"type":"array","items":"option","custom":"com.atlassian.jira.plugin.system.customfieldtypes:multiselect","customId":10028},"name":"multi select","key":"customfield_10028","hasDefaultValue":false,"operations":["add","set","remove"],"allowedValues":[{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10006","value":"qwerty","id":"10006"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10007","value":"asdfghj","id":"10007"},{"self":"https://jiragrazitti1.atlassian.net/rest/api/2/customFieldOption/10008","value":"zxcvbnm","id":"10008"}]},"customfield_10018":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10018},"name":"Precondition","key":"customfield_10018","hasDefaultValue":false,"operations":["set"]},"customfield_10029":{"required":false,"schema":{"type":"array","items":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:labels","customId":10029},"name":"CaseNumber","key":"customfield_10029","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/1.0/labels/suggest?customFieldId=10029&query=","hasDefaultValue":false,"operations":["add","set","remove"]},"customfield_10008":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10008},"name":"Epic Link","key":"customfield_10008","hasDefaultValue":false,"operations":["set"]},"customfield_10019":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10019},"name":"Biz Impact","key":"customfield_10019","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","key":"attachment","hasDefaultValue":false,"operations":[]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","key":"issuelinks","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","key":"assignee","autoCompleteUrl":"https://jiragrazitti1.atlassian.net/rest/api/latest/user/assignable/search?project=TP&username=","hasDefaultValue":false,"operations":["set"]}}}]}]}';
                            
                            }
                    
                    
                    if((res!=null && res.getStatusCode()==200)  ||Test.isRunningTest()){
                        Map<String, Object> Main = (Map<String, Object>) JSON.deserializeUntyped(JsonStringData);
                        Object JsonObj=Main.get('projects');
                        String JsonString = JSON.serialize(JsonObj);
                        ProjectsJson jsondata;
                        ProjectsJsonWithOutAllowed JsonDataNotAllowed;
                        JSONParser parser1 = JSON.createParser(JsonString);
                        
                        JSONParser parser = JSON.createParser(JsonString);
                        while (parser.nextToken() != null) {
                            if(parser.getCurrentToken()==JSONToken.START_OBJECT ){ 
                                jsondata=(ProjectsJson)parser.readValueAs(ProjectsJson.class);
                                if(Finaljsondata==null){
                                    Finaljsondata=jsondata;
                                }else{
                                    Finaljsondata.issuetypes.addall(jsondata.issuetypes);
                                }
                            }
                        }
                        while (parser1.nextToken() != null) {
                            if(parser1.getCurrentToken()==JSONToken.START_OBJECT ){ 
                                JsonDataNotAllowed=(ProjectsJsonWithOutAllowed)parser1.readValueAs(ProjectsJsonWithOutAllowed.class);
                                if(FinaljsondataNotAllowed==null){
                                    FinaljsondataNotAllowed=JsonDataNotAllowed;
                                }else{
                                    FinaljsondataNotAllowed.issuetypes.addall(JsonDataNotAllowed.issuetypes);
                                }
                            }
                        }
                    }else{
                        JiraLogsToInsert.add(GenerateJiraLogs.CreateJiraLog('UpdateProjectRelatedData',req.getEndpoint(), req.getMethod(), String.valueof(res.getstatusCode()),res.getbody(),res.getstatus(), req.getbody() , null, ProjectKey , 'Project Data', res.getbody()));
                        
                    } 
                }catch(Exception ex){
                    String Error=System.label.cause_Label +ex.getCause()+'\n'+ System.label.LineNumber_Label +ex.getLineNumber()+'\n'+ System.label.Message_Label +ex.getMessage();
                    JiraLogsToInsert.add(GenerateJiraLogs.CreateJiraLog('UpdateProjectRelatedData',req.getEndpoint(), req.getMethod(), String.valueof(res.getstatusCode()),res.getbody(),res.getstatus(), req.getbody() , null, ProjectKey , 'Project Data', Error));
                    return;
                } 
                
            }  
            
            for(Jira_ProjectFieldsMapping__c SfField:[SELECT Id, Name,Jira_project__r.Projectkey__c,JIRA_Field_Api_Name__c,DataType__c,Jira_Field_Name__c,IsStatic__c FROM Jira_ProjectFieldsMapping__c where Jira_Project__c=:proId]){
                String Issuejsondata;
                if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IssueTypeData__c.isUpdateable()){
                    SfField.IssueTypeData__c=null;
                }
                if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.ReqInIssueTypeData__c.isUpdateable()){
                    SfField.ReqInIssueTypeData__c=null; 
                }
                for( ProjectsJson.IssueType Issues:Finaljsondata.issuetypes){
                    map<String,ProjectsJson.FieldJson>  fields=Issues.fields;
                    if(fields.get(SfField.JIRA_Field_Api_Name__c)!=null){
                        ProjectsJson.FieldJson FieldJson=fields.get(SfField.JIRA_Field_Api_Name__c);
                        if(Issuejsondata==null){
                            Issuejsondata='{"'+Issues.id +'":"'+Issues.name.escapejava() +'"}';
                        }else{
                            Issuejsondata+=',{"'+Issues.id +'":"'+Issues.name.escapejava() +'"}';
                        }
                        if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IssueTypeData__c.isUpdateable()){
                            if( SfField.IssueTypeData__c==null){
                                SfField.IssueTypeData__c=Issues.name;  
                            }else{
                                SfField.IssueTypeData__c+=','+Issues.name;
                            }
                        }
                        if(FieldJson.required){
                            if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IsRequired__c.isUpdateable()){
                                SfField.IsRequired__c=true;
                            }
                            if(SfField.ReqInIssueTypeData__c==null && Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.ReqInIssueTypeData__c.isUpdateable()){
                                SfField.ReqInIssueTypeData__c=Issues.name;
                            }else{
                                if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.ReqInIssueTypeData__c.isUpdateable()){
                                    SfField.ReqInIssueTypeData__c+=','+Issues.name;
                                }
                            }
                        }
                        if(SfField.ReqInIssueTypeData__c==null || SfField.ReqInIssueTypeData__c==''){
                            if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IsRequired__c.isUpdateable()){
                                SfField.IsRequired__c=false;
                            }
                        }
                        if(FieldJson.schema.custom!=Null && schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.DataType__c.isUpdateable()){
                            SfField.DataType__c =FieldJson.schema.custom.substring(FieldJson.schema.custom.lastIndexOf(':')+1,FieldJson.schema.custom.length()) ;
                        }else if(FieldJson.schema.items!=Null && schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.DataType__c.isUpdateable()){
                            SfField.DataType__c =FieldJson.schema.items;
                        } else{
                            if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.DataType__c.isUpdateable()){
                                SfField.DataType__c =FieldJson.schema.type; 
                            }
                        }
                        if(SfField.DataType__c =='date' && schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.DataType__c.isUpdateable()){
                            SfField.DataType__c ='datepicker';
                        }
                        if(SfField.DataType__c.toLowerCase() =='userpicker'||SfField.DataType__c.toLowerCase() =='multiuserpicker'||SfField.DataType__c.toLowerCase() =='user' ){
                            //UserTypeFieldList.add(SfField);
                            if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IsArray__c.isUpdateable()){
                                SFField.IsArray__c=true;
                            }
                        } 
                        if(FieldJson.schema.type=='array' && schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IsArray__c.isUpdateable()){
                            SfField.IsArray__c=true;
                        }else{
                            if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IsArray__c.isUpdateable()){
                                SFField.IsArray__c=false;
                            }
                        }
                       
                        if(FieldJson.allowedValues!=null && FieldJson.allowedValues.size()>0){
                            if(FieldJson.schema.items!='version' && FieldJson.schema.type!='version' && schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IsArray__c.isUpdateable()){
                                SfField.IsArray__c=true;
                            }
                            String jsonformulti='';
                            String childjson='';
                            for(ProjectsJson.allowedValuesobj  all:FieldJson.allowedValues){
                                if(all.value!=Null){
                                    jsonformulti= jsonformulti+'{"'+ all.id + '":"'+(all.value).escapeJava()+'"},';
                                }else if(all.name!=null){
                                    jsonformulti= jsonformulti+'{"'+ all.id + '":"'+(all.name).escapeJava()+'"},';
                                }
                                
                                if(all.children!=null && !all.children.isEmpty()){
                                    childjson='';
                                    for(ProjectsJson.Children  ch:all.children){
                                        childjson+='{"'+ch.id +'":"' + (ch.value).escapejava()+'"},';
                                    }
                                    jsonformulti=jsonformulti.removeEnd('},');
                                    childjson=childjson.removeEnd(',');
                                    childjson=',"Children":['+childjson +']},';
                                    jsonformulti +=childjson;
                                }
                            }
                            jsonformulti=jsonformulti.removeEnd(',');
                            jsonformulti='{"allowedValues":['+jsonformulti+']}';
                            if(jsonformulti!=NULL && Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.ProjectissueTypeData__c.isUpdateable()){
                                SfField.ProjectissueTypeData__c=jsonformulti.replace('\t','');  
                            }
                        }else{
                            if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.ProjectissueTypeData__c.isUpdateable()){
                                SFField.ProjectissueTypeData__c=null;
                            }
                            
                        }
                        if(SfField.Jira_Field_API_Name__c =='priority' || SfField.datatype__c=='securitylevel'){
                            if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.datatype__c.iscreateable()){
                                SfField.datatype__c='select';
                            }
                        } 
                        
                        if(FieldJson.name!=null && Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.Jira_Field_Name__c.isUpdateable()){
                            SfField.Jira_Field_Name__c=FieldJson.name;
                        }
                        else if(FieldJson.key!=null && Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.Jira_Field_Name__c.isUpdateable()){
                            SfField.Jira_Field_Name__c=FieldJson.key;
                        }
                    }
                }
                if(SfField.JIRA_Field_Api_Name__c=='issuetype'){
                    if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.Name.isUpdateable()) {
                        SFField.Name='Issue Type';
                    }
                    if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.ProjectissueTypeData__c.isUpdateable()) {
                        SFField.ProjectissueTypeData__c ='{"allowedValues":['+Issuejsondata.replace('\t','')+']}';
                    }
                    if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.DataType__c.isUpdateable()) {
                        SFField.DataType__c='select';
                    }
                    if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IsArray__c.isUpdateable()) {
                        SFField.IsArray__c=true;
                    }
                }
                else if(SfField.JIRA_Field_Api_Name__c=='status'){
                    if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IssueTypeData__c.isUpdateable()) {
                        SFField.IssueTypeData__c='All';
                    }
                    if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.Name.isUpdateable()) {
                        SFField.Name='Status';
                    }
                    if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.DataType__c.isUpdateable()) {
                        SFField.DataType__c='select';
                    }
                    if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IsArray__c.isUpdateable()) {
                        SFField.IsArray__c=true;
                    }
                }
                else if(SfField.JIRA_Field_Api_Name__c=='key'){
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.Name.isUpdateable()){
                        SFField.Name='Jira Issue Number';
                    }
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IssueTypeData__c.isUpdateable()){
                        SFField.IssueTypeData__c='All';
                    }
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.DataType__c.isUpdateable()){
                        SFField.DataType__c='string';
                    }
                }
                else if(SfField.JIRA_Field_Api_Name__c=='link'){
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.Name.isUpdateable()){
                        SFField.Name='Jira Issue Link';
                    }
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.DataType__c.isUpdateable()){
                        SFField.DataType__c='string';
                    }
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IssueTypeData__c.isUpdateable()){
                        SFField.IssueTypeData__c='All';
                    }
                }
                else if(SfField.JIRA_Field_Api_Name__c=='resolutiondate'){
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IssueTypeData__c.isUpdateable()){
                        SFField.IssueTypeData__c='All';
                    }
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.Name.isUpdateable()){
                        SFField.Name='Resolutiondate';
                    }
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.DataType__c.isUpdateable()){
                        SFField.DataType__c='string';
                    }
                    if(Schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.ViewMode__c.isUpdateable()) {
                        SfField.ViewMode__c=true;
                    }
                }
                else if(SfField.JIRA_Field_Api_Name__c=='resolution'){
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.Name.isUpdateable()){
                        SFField.Name='Resolution';
                    }
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IssueTypeData__c.isUpdateable()){
                        SFField.IssueTypeData__c='All';
                    }
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.DataType__c.isUpdateable()){
                        SFField.DataType__c='select';
                    }
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IsArray__c.isUpdateable()){
                        SFField.IsArray__c=true;
                    }
                    if(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.ViewMode__c.isUpdateable()){
                        SfField.ViewMode__c=true;
                    }
                }
                if(SfField.DataType__c.toLowerCase() =='issuelinks'){
                    LinkedIssuesFieldList.add(SfField);
                }
                IF(schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IsArray__c.isUpdateable() && (SFField.DataType__c.toLowerCase() =='userpicker'||
                                                                                                        SFField.DataType__c.toLowerCase() =='multiuserpicker'||
                                                                                                        SFField.DataType__c.toLowerCase() =='user')){
                                                                                                            SFField.IsArray__c=true;
                                                                                                        }
                if(schema.sObjectType.Jira_ProjectFieldsMapping__c.isUpdateable()){
                    FdList.add(SFField);
                }
            }
            String LinkedIssuesData='';
            
            if(!LinkedIssuesFieldList.isEmpty()){
                HttpRequest  Linkreq = new HttpRequest();
                Linkreq = CreateJIRAWrapper.CreateRequest('/rest/api/2/issueLinkType', 'GET', 'application/json');
                HttpResponse reslink = new HttpResponse();
                Http httplink = new Http();
                try{
                    String jsonInputLink;
                    if(!test.isRunningTest()){
                        reslink = httplink.send(Linkreq);
                        jsonInputLink = reslink.getBody();
                    }else {
                        jsonInputLink='{"issueLinkTypes":[{"id":"10302","name":"block","inward":"blocked","outward":"blocking","self":"http://45.79.128.241:8080/rest/api/2/issueLinkType/10302"},{"id":"10300","name":"clone","inward":"Duplicated by","outward":"Duplicates","self":"http://45.79.128.241:8080/rest/api/2/issueLinkType/10300"},{"id":"10001","name":"cloneR","inward":"Duplicated by","outward":"Duplicates","self":"http://45.79.128.241:8080/rest/api/2/issueLinkType/10001"},{"id":"10301","name":"clones","inward":"Duplicated by","outward":"Duplicates","self":"http://45.79.128.241:8080/rest/api/2/issueLinkType/10301"},{"id":"10002","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"http://45.79.128.241:8080/rest/api/2/issueLinkType/10002"},{"id":"10003","name":"Relates","inward":"relates to","outward":"relates to","self":"http://45.79.128.241:8080/rest/api/2/issueLinkType/10003"}]}';               
                    }
                    if((res!=null && res.getStatusCode()==200)  ||Test.isRunningTest()){
                        Map<String,Object> MainLinkedIssues = (Map<String, Object>) JSON.deserializeUntyped(jsonInputLink);
                        For(String IssueLinkTypes : MainLinkedIssues.Keyset()){
                            
                            List<Object> Final_list = (List<Object>)MainLinkedIssues.get(IssueLinkTypes);
                            For(Object finalobj : Final_list){
                                Map<String,object> AllowedvaluesMap = (Map<String,object>) finalobj;
                                String AllowedValues=String.valueof(AllowedvaluesMap.get('name'));
                                LinkedIssuesData +='{"'+AllowedvaluesMap.get('id')+'":"'+AllowedValues.escapeJava()+'"},'; 
                            }
                            LinkedIssuesData = LinkedIssuesData.removeEnd(',');
                        }
                    }else{
                        JiraLogsToInsert.add(GenerateJiraLogs.CreateJiraLog('UpdateProjectRelatedData',Linkreq.getEndpoint(), Linkreq.getMethod(), String.valueof(reslink.getstatusCode()),reslink.getbody(),reslink.getstatus(), reslink.getbody() , null, ProjectKey , 'Issue Link Type', reslink.getBody()));
                        
                    }
                }catch(Exception ex){
                    String Error=System.label.cause_Label +ex.getCause()+'\n'+ System.label.LineNumber_Label +ex.getLineNumber()+'\n'+ System.label.Message_Label +ex.getMessage();
                    JiraLogsToInsert.add(GenerateJiraLogs.CreateJiraLog('UpdateProjectRelatedData',Linkreq.getEndpoint(), Linkreq.getMethod(), String.valueof(reslink.getstatusCode()),reslink.getbody(),reslink.getstatus(), reslink.getbody() , null, ProjectKey , 'Issue Link Type', Error));
                    
                }
            }
            if(!FdList.isEmpty()){
                /*  req = new HttpRequest();
String AssigneeData='';
req = CreateJIRAWrapper.CreateRequest('/rest/api/2/user/assignable/multiProjectSearch?projectKeys='+ProjectKey+'&maxResults=1000', 'GET', 'application/json');

http = new Http();
try {
String jsonInput;
res = http.send(req);
jsonInput = res.getBody();
if(res.getStatusCode()==200){
List<Object> Main = (List< Object>) JSON.deserializeUntyped(jsonInput);
for(object key:Main){
Map<String, Object> Index = (Map<String, Object>) key;
AssigneeData+='{"'+Index.get('key')+'":"'+Index.get('displayName')+'"},';
}
AssigneeData=AssigneeData.removeEnd(',');
}
}catch(Exception ex){
String Error=ex.getCause()+'\n'+ex.getLineNumber()+'\n'+ex.getMessage();
GenerateJiraLogs.CreateLogRealTime('RefreshFieldConfiguration',req.getEndpoint(), req.getMethod(), String.valueof(res.getstatusCode()),res.getbody(),res.getstatus(), req.getbody() , null, ProjectKey , 'UpdateProjectsAndRelatedFieldsInfoAndData', Error);
}*/
                for(Jira_ProjectFieldsMapping__c SFField: FdList){
                    if(SfField.DataType__c.toLowerCase() =='issuelinks' && 
                       schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.IsArray__c.isUpdateable() &&
                       schema.sObjectType.Jira_ProjectFieldsMapping__c.fields.ProjectissueTypeData__c.isUpdateable() ){
                           SFField.IsArray__c=true;
                           
                           
                           SFField.ProjectissueTypeData__c='{"allowedValues":['+LinkedIssuesData.replace('\t','')+']}';
                       }
                }    
                
            }            
            //list<ContentDocument> CdList = new list<ContentDocument>();
            list<ContentVersion> CvList = new list<ContentVersion>();
            
            String Title=ProjectKey+'_Json.txt';
            
            String Title1=ProjectKey+'_NotAllowedJson.txt';
            
            CvList = [select id ,ContentDocumentId  from contentversion where Title=:Title or Title =:Title1 ];
            //CdList = [select id   from ContentDocument where Title=:Title];
            if(!CvList.isEmpty()){
                
                List<ContentDocument> cdList= new List<ContentDocument>();
                for(ContentVersion  cv1:CvList){
                    ContentDocument cd= new ContentDocument();
                    cd.id=cv1.ContentDocumentId;
                    cdList.add(cd);
                }
                try{ 
                    if(schema.sObjectType.ContentDocument.isDeletable()){
                        delete CdList;
                    }
                    
                }catch(Exception ex){
                    String Error=System.label.cause_Label +ex.getCause()+'\n'+ System.label.LineNumber_Label +ex.getLineNumber()+'\n'+ System.label.Message_Label +ex.getMessage();
                    JiraLogsToInsert.add(GenerateJiraLogs.CreateJiraLog('UpdateProjectRelatedData',null, null, null,null,null, null , null, null, 'Delete ContentDocument', Error));
                }
            }   
            CvList = new list<ContentVersion>();
            ContentVersion cv = new ContentVersion();
            String data='{"projects":['+ Json.serialize(Finaljsondata)+']}';
            Blob b = blob.valueof(data); //decoded string
            
            if( schema.sObjectType.ContentVersion.fields.VersionData.isCreateable()){
                cv.VersionData = b;
            }
            
            if( schema.sObjectType.ContentVersion.fields.Title.isCreateable()){
                cv.Title = Title;
            }
            
            if(schema.sObjectType.ContentVersion.fields.PathOnClient.isCreateable()){
                cv.PathOnClient  =  Title;
            }
            
            CvList.add(cv);
            
            ContentVersion cvNotAllowed = new ContentVersion();
            String dataNotAllowed='{"projects":['+ Json.serialize(FinaljsondataNotAllowed)+']}';
            
            b = blob.valueof(dataNotAllowed); //decoded string
            if( schema.sObjectType.ContentVersion.fields.VersionData.isCreateable()){
                cvNotAllowed.VersionData = b;
            }
            if( schema.sObjectType.ContentVersion.fields.Title.isCreateable()){
                cvNotAllowed.Title = Title1;
            }
            if(schema.sObjectType.ContentVersion.fields.PathOnClient.isCreateable()){
                cvNotAllowed.PathOnClient  =  Title1;
            }
            CvList.add(cvNotAllowed);
            try{
                if(schema.sObjectType.ContentVersion.isCreateable() ){
                    insert CvList;
                }
            }catch(Exception ex){
                String Error=System.label.cause_Label +ex.getCause()+'\n'+ System.label.LineNumber_Label +ex.getLineNumber()+'\n'+ System.label.Message_Label +ex.getMessage();
                JiraLogsToInsert.add(GenerateJiraLogs.CreateJiraLog('UpdateProjectRelatedData',null, null, null,null,null, null , null, null, 'Insert ContentVersion', Error));
            }
            //list<ContentVersion> CvList2 = new list<ContentVersion>();
            list<ContentDocumentLink> ContentDocumentLinkList= new List<ContentDocumentLink>();
            for(ContentVersion cv1 : [SELECT Id, ContentDocumentId FROM ContentVersion where id= :CvList]){
                
                ContentDocumentLink Cdl= new ContentDocumentLink();
                
                if(Schema.sObjectType.ContentDocumentLink.fields.LinkedEntityId.isCreateable()){ 
                    cdl.LinkedEntityId=Proid;
                }
                if(Schema.sObjectType.ContentDocumentLink.fields.ShareType.isCreateable()){ 
                    cdl.ShareType ='I';
                }
                if(Schema.sObjectType.ContentDocumentLink.fields.ContentDocumentId.isCreateable()){ 
                    cdl.ContentDocumentId=cv1.ContentDocumentId;
                }
                
                ContentDocumentLink CdlOrg= new ContentDocumentLink();
                if(Schema.sObjectType.ContentDocumentLink.fields.LinkedEntityId.isCreateable()){ 
                    CdlOrg.LinkedEntityId=UserInfo.getOrganizationId() ;
                }
                
                if(Schema.sObjectType.ContentDocumentLink.fields.ShareType.isCreateable()){ 
                    CdlOrg.ShareType ='C';
                }
                
                if(Schema.sObjectType.ContentDocumentLink.fields.ContentDocumentId.isCreateable()){
                    CdlOrg.ContentDocumentId=cv1.ContentDocumentId;
                }
                
                
                ContentDocumentLinkList.add(cdl);
                ContentDocumentLinkList.add(CdlOrg);
                
            }
            try{
                if(!ContentDocumentLinkList.IsEmpty()){
                    
                    if(schema.sObjectType.ContentDocumentLink.isCreateable()){
                        insert ContentDocumentLinkList;
                    }
                    if(Project.id!=null){
                        if(schema.sObjectType.Jira_Project__c.fields.HasJson__c.isCreateable() && schema.sObjectType.Jira_Project__c.fields.HasJson__c.isUpdateable()){
                            Project.HasJson__c=true;
                        }
                        if(schema.sObjectType.Jira_Project__c.isUpdateable()){
                            update Project;
                        }
                    }
                    
                }
                
                if(!FdList.isEmpty() && schema.sObjectType.Jira_ProjectFieldsMapping__c.isUpdateable()){
                    update FdList;
                    
                }
            }catch(Exception ex){
                String Error=System.label.cause_Label +ex.getCause()+'\n'+ System.label.LineNumber_Label +ex.getLineNumber()+'\n'+ System.label.Message_Label +ex.getMessage();
                JiraLogsToInsert.add(GenerateJiraLogs.CreateJiraLog('UpdateProjectRelatedData',null, null, null,null,null, null , null, null, 'Insert ContentDocumentLink,Update Project and Field Mapping', Error));
                
            }
        }
        
    }
    
    global void finish(Database.BatchableContext BC){
        if(!JiraLogsToInsert.isEmpty()){
            Insert JiraLogsToInsert;
        }
    }
}